image: "tbcp/python"

before_script:
  - make init-requirements

stages:
  - Static Analysis
  - Unit Testing
  - Building
  - Function Testing
  - Deployment
  - Release
  - Documenting

types:
  stage: Static Analysis
  script: [make check-types]
  allow_failure: true

linting:
  stage: Static Analysis
  script: [make check-lint]
  allow_failure: true

secure-code:
  stage: Static Analysis
  script: [make check-secure-code]
  allow_failure: false

unit-test:
  stage: Unit Testing
  script: [make unit-test]

build:
  stage: Building
  script: [make build]
  artifacts:
    paths: [dist]
  only:
    - develop
    - main

deploy-develop:
  stage: Deployment
  script: [make deploy]
  artifacts:
    paths: [dist]
  only:
    - develop
    - main

deploy-release:
  stage: Release
  script: [make release]
  artifacts:
    paths: [dist]
  only:
    - release

docsify:
  stage: Documenting
  script:
    - rm -rf public && mkdir public
    - cp -r docs/* public/ && cp -r README.md public/_media/
  artifacts:
    paths: [public]
    expire_in: 10 seconds
